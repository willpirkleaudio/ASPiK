<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Messaging Custom Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cv9.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Messaging Custom Objects </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We implemented custom knob as an example of using the same lock-free ring buffer concept to move messages between the plugin core and the custom objects as opposed to moving audio data. Here we have set up a custom data structure that contains the messaging information - some basic stuff is there and you are encouraged to experiment with your own messaging and custom view work. In this example, we will pick up the knob's custom view interface pointer and use it to send a custom message to the object, which will acknowledge back (pretty cool, huh?).<br  />
 <br  />
 The custom message structure is shown below; in this example, we are only going to use the two std::strings, one to query the object and the other to access information it returns to us:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>CustomViewMessage </div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- show/hide flag</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> message = MESSAGE_HIDE_CONTROL;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">bool</span> visible = <span class="keyword">true</span>;</div>
<div class="line">   <span class="keywordtype">bool</span> showAlternateGraphic = <span class="keyword">false</span>;</div>
<div class="line">   <span class="keywordtype">double</span> controlAlpha = 1.0; <span class="comment">// transparency: 0 = invisible (100% transparent) and 1 = solidly visible (0% transparent)</span></div>
<div class="line">   std::string queryString;</div>
<div class="line">   std::string replyString;</div>
<div class="line">   <span class="keywordtype">void</span>* messageData = <span class="keyword">nullptr</span>;</div>
<div class="line">};</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>In the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a>, we'll communicate with the knob when the custom view is registered (only as an example - you can experiment with this all you like). The code for the PLUGINGUI_REGISTER_CUSTOMVIEW is shown here (it follows the registration code for the two custom audio viewer objects). Set a breakpoint in the debugger and run the plugin - when you open the GUI, you can check the communication and reply you get back by examining the return string. Notice also that we set up this object so that it copies it's "this" poitner into the messageData variable on the message data structure. Using this, you can (in theory) obtain a pointer to the underlying object itself, <b>HOWEVER THIS IS NOT RECOMMENDED AS IT IS VERY DANGEROUS WAY OF CODING</b>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (messageInfo.inMessageString.compare(<span class="stringliteral">&quot;CustomKnobView&quot;</span>) == 0) </div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- (1) get the custom view interface via incoming message data*</span></div>
<div class="line">   <span class="keywordflow">if</span> (knobView != <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="class_i_custom_view.html">ICustomView</a>*<span class="keyword">&gt;</span>(messageInfo.inMessageData))</div>
<div class="line">      knobView = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="class_i_custom_view.html">ICustomView</a>*<span class="keyword">&gt;</span>(messageInfo.inMessageData);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (!knobView) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- send the view a message</span></div>
<div class="line">   CustomViewMessage knobMessage;</div>
<div class="line">   knobMessage.message = MESSAGE_QUERY_CONTROL;</div>
<div class="line">   knobMessage.queryString.assign(<span class="stringliteral">&quot;Hello There!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- send the message</span></div>
<div class="line">   knobView-&gt;sendMessage(&amp;knobMessage);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- check the reply string</span></div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span>* reply = knobMessage.replyString.c_str();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- this will dequeue the object&#39;s ring buffer</span></div>
<div class="line">   knobView-&gt;updateView();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- DO NOT DO THIS!!! (but it is possible)</span></div>
<div class="line">   <span class="comment">//CAnimKnob* customKnob = static_cast&lt;CAnimKnob*&gt;(knobMessage.messageData);</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- registered!</span></div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//</span></div>
<div class="ttc" id="aclass_i_custom_view_html"><div class="ttname"><a href="class_i_custom_view.html">ICustomView</a></div><div class="ttdoc">Custom View interface to allow plugin core to create safe communication channels with GUI custom view...</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:1462</div></div>
</div><!-- fragment --><p>The knob's ::sendMessage( ) function that decodes the query, fixes the reply, and (risky) copies its THIS pointer to the message structure is here:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CustomKnobView::sendMessage(<span class="keywordtype">void</span>* data)</div>
<div class="line">{</div>
<div class="line">   CustomViewMessage* viewMessage = <span class="keyword">static_cast&lt;</span>CustomViewMessage*<span class="keyword">&gt;</span>(data);</div>
<div class="line">   <span class="keywordflow">if</span> (!viewMessage) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (viewMessage-&gt;message == MESSAGE_QUERY_CONTROL)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span> (viewMessage-&gt;queryString.compare(<span class="stringliteral">&quot;Hello There!&quot;</span>) == 0)</div>
<div class="line">      {</div>
<div class="line">         viewMessage-&gt;replyString.assign(<span class="stringliteral">&quot;I&#39;m Here!!&quot;</span>);</div>
<div class="line">         viewMessage-&gt;messageData = <span class="keyword">this</span>; <span class="comment">// &lt;-- example of VERY risky thing to do; not recommended</span></div>
<div class="line">      }</div>
<div class="line">   </div>
<div class="line">      <span class="keywordflow">return</span>; <span class="comment">// do not process further</span></div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// ---&gt;&gt; CustomViewMessage has =operator</span></div>
<div class="line">   dataQueue-&gt;enqueue(*viewMessage);</div>
<div class="line">}</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>At the end of the function, the message is added to the local lock-free ring buffer queue for further processing (not needed here) and in the updateView() method the ring-buffer is emptied (note that we called it after getting the reply message in the previous function).<br  />
 <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer11.html">Custom Views</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
