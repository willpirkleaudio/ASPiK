<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: MIDI Message Processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('define_plugin75.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MIDI Message Processing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>MIDI messages are sent to the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a>'s buffer processing function as part of the normal <a class="el" href="define_plugin6.html">The Buffer Processing Cycle</a> and arrive in a queue, timestamped with the sample number corresponding to locations in the DAW I/O buffers. The <a class="el" href="class_plugin_base.html" title="The PluginBase object is the base class for the Plugin Core object.">PluginBase</a> implements the <b>processAudioBuffers</b> method and fires MIDI events into the processing loop depending on your audio processing method. The <a class="el" href="structmidi_event.html" title="Information about a MIDI event.">midiEvent</a> structure holds the information for each MIDI message and has many member variables; here I am only showing the normal message members and the sample-accurate index value:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structmidi_event.html">midiEvent</a></div>
<div class="line">{</div>
<div class="line"><span class="comment">// --- constructors and overloaded = operators removed here</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">   uint32_t    <a class="code hl_variable" href="structmidi_event.html#a9c88bc239299528106a4dac822d08e02">midiMessage</a> = 0;      </div>
<div class="line">   uint32_t    <a class="code hl_variable" href="structmidi_event.html#adad487dfd8c46f34f86c8cddc0554943">midiChannel</a> = 0;      </div>
<div class="line">   uint32_t    <a class="code hl_variable" href="structmidi_event.html#a6cb0a801634c56e8562c72caf0a01930">midiData1</a> = 0;        </div>
<div class="line">   uint32_t    <a class="code hl_variable" href="structmidi_event.html#af15acefc47c9434839e58c3fd3d80a54">midiData2</a> = 0;        </div>
<div class="line">   uint32_t    <a class="code hl_variable" href="structmidi_event.html#ae90361b2d3743386203b34fc0edaf1dc">midiSampleOffset</a> = 0; </div>
<div class="line"> };</div>
<div class="ttc" id="astructmidi_event_html"><div class="ttname"><a href="structmidi_event.html">midiEvent</a></div><div class="ttdoc">Information about a MIDI event.</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:562</div></div>
<div class="ttc" id="astructmidi_event_html_a6cb0a801634c56e8562c72caf0a01930"><div class="ttname"><a href="structmidi_event.html#a6cb0a801634c56e8562c72caf0a01930">midiEvent::midiData1</a></div><div class="ttdeci">uint32_t midiData1</div><div class="ttdoc">BYTE data 1 as UINT.</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:643</div></div>
<div class="ttc" id="astructmidi_event_html_a9c88bc239299528106a4dac822d08e02"><div class="ttname"><a href="structmidi_event.html#a9c88bc239299528106a4dac822d08e02">midiEvent::midiMessage</a></div><div class="ttdeci">uint32_t midiMessage</div><div class="ttdoc">BYTE message as UINT.</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:641</div></div>
<div class="ttc" id="astructmidi_event_html_adad487dfd8c46f34f86c8cddc0554943"><div class="ttname"><a href="structmidi_event.html#adad487dfd8c46f34f86c8cddc0554943">midiEvent::midiChannel</a></div><div class="ttdeci">uint32_t midiChannel</div><div class="ttdoc">BYTE channel as UINT.</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:642</div></div>
<div class="ttc" id="astructmidi_event_html_ae90361b2d3743386203b34fc0edaf1dc"><div class="ttname"><a href="structmidi_event.html#ae90361b2d3743386203b34fc0edaf1dc">midiEvent::midiSampleOffset</a></div><div class="ttdeci">uint32_t midiSampleOffset</div><div class="ttdoc">sample offset of midi event within audio buffer</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:645</div></div>
<div class="ttc" id="astructmidi_event_html_af15acefc47c9434839e58c3fd3d80a54"><div class="ttname"><a href="structmidi_event.html#af15acefc47c9434839e58c3fd3d80a54">midiEvent::midiData2</a></div><div class="ttdeci">uint32_t midiData2</div><div class="ttdoc">BYTE data 2 as UINT.</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:644</div></div>
</div><!-- fragment --><p>Regardless of the processing paradigm, the same MIDI function is usd to process these messages and uses a simple <b><a class="el" href="structmidi_event.html" title="Information about a MIDI event.">midiEvent</a></b> structure to store the message data:</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code hl_function" href="class_plugin_core.html#a24f1a0b139eb08b87adb902bfb4fbce0">PluginCore::processMIDIEvent</a>(<a class="code hl_struct" href="structmidi_event.html">midiEvent</a>&amp; event)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- IF PROCESSING AUDIO BLOCKS: push into vector for block processing</span></div>
<div class="line">   <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_plugin_base.html#ad91b6d23100576a783948ca7e83f373a">pluginDescriptor</a>.<a class="code hl_variable" href="struct_plugin_descriptor.html#a6665c6a59705638c38a12c40d451ce43">processFrames</a>)</div>
<div class="line">   {</div>
<div class="line">      processBlockInfo.<a class="code hl_function" href="struct_process_block_info.html#af4c3704216cce276783d9c40c504bc13">pushMidiEvent</a>(event);</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- IF PROCESSING AUDIO FRAMES: decode AND service this MIDI event here</span></div>
<div class="line">   <span class="comment">//     for sample accurate MIDI</span></div>
<div class="line">   <span class="comment">// myMIDIMessageHandler(event); // &lt;-- you write this</span></div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="ttc" id="aclass_plugin_base_html_ad91b6d23100576a783948ca7e83f373a"><div class="ttname"><a href="class_plugin_base.html#ad91b6d23100576a783948ca7e83f373a">PluginBase::pluginDescriptor</a></div><div class="ttdeci">PluginDescriptor pluginDescriptor</div><div class="ttdoc">description strings</div><div class="ttdef"><b>Definition:</b> pluginbase.h:415</div></div>
<div class="ttc" id="aclass_plugin_core_html_a24f1a0b139eb08b87adb902bfb4fbce0"><div class="ttname"><a href="class_plugin_core.html#a24f1a0b139eb08b87adb902bfb4fbce0">PluginCore::processMIDIEvent</a></div><div class="ttdeci">virtual bool processMIDIEvent(midiEvent &amp;event)</div><div class="ttdoc">process a MIDI event</div><div class="ttdef"><b>Definition:</b> plugincore.cpp:606</div></div>
<div class="ttc" id="astruct_plugin_descriptor_html_a6665c6a59705638c38a12c40d451ce43"><div class="ttname"><a href="struct_plugin_descriptor.html#a6665c6a59705638c38a12c40d451ce43">PluginDescriptor::processFrames</a></div><div class="ttdeci">bool processFrames</div><div class="ttdoc">want frames (default)</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:1280</div></div>
<div class="ttc" id="astruct_process_block_info_html_af4c3704216cce276783d9c40c504bc13"><div class="ttname"><a href="struct_process_block_info.html#af4c3704216cce276783d9c40c504bc13">ProcessBlockInfo::pushMidiEvent</a></div><div class="ttdeci">void pushMidiEvent(midiEvent event)</div><div class="ttdef"><b>Definition:</b> pluginstructures.h:1082</div></div>
</div><!-- fragment --><p>Notice how this function works: <br  />
 <b>Processing sub-blocks or buffers</b>: <br  />
 The <b>pluginDescriptor.processFrames</b> boolean will be <b>false</b>; in this case a special function is called to load the incoming MIDI message into a vector that will be usually be serviced, all at once, at the top of the block processing function; note that you may also perform this in a sample accurate manner, but it will require some coding on your part to match up the <a class="el" href="structmidi_event.html" title="Information about a MIDI event.">midiEvent</a>'s midiSampleOffset index (the sample location within the DAW audio buffers) with the block or buffer (for buffer processing this is trivial as the sample offsets will match up with your for( ) loop), but for sub-block processing, you will need to keep track of the blocks and samples per buffer (see the preProcessAudioBuffers function for a location to set this up). However, there are good reasons for procssing the MIDI at the top of sub-blocks as detailed in my Synth book (and many synth manufacturers use this same paradigm).</p>
<div class="fragment"><div class="line"><span class="comment">// --- process all MIDI events in this block (same as SynthLab)</span></div>
<div class="line">uint32_t midiEvents = blockInfo.getMidiEventCount();</div>
<div class="line"><span class="keywordflow">for</span> (uint32_t i = 0; i &lt; midiEvents; i++)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- get the event</span></div>
<div class="line">   <a class="code hl_struct" href="structmidi_event.html">midiEvent</a> <span class="keyword">event</span> = *blockInfo.getMidiEvent(i);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- do something with it...</span></div>
<div class="line">   <span class="comment">// myMIDIMessageHandler(event); // &lt;-- you write this</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// --- render a block of audio; here it is silence but in your synth</span></div>
<div class="line"><span class="comment">//     it will likely be dependent on the MIDI processing you just did above</span></div>
<div class="line"><span class="keywordflow">for</span> (uint32_t sample = blockInfo.blockStartIndex, i = 0;</div>
<div class="line">     sample &lt; blockInfo.blockStartIndex + blockInfo.blockSize;</div>
<div class="line">     sample++, i++)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- write outputs</span></div>
<div class="line">   <span class="keywordflow">for</span> (uint32_t channel = 0; channel &lt; blockInfo.numAudioOutChannels; channel++)</div>
<div class="line">   {</div>
<div class="line">      <span class="comment">// --- silence (or, your synthesized block of samples)</span></div>
<div class="line">      blockInfo.outputs[channel][sample] = 0.0;</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p><b>Processing Frames</b>: <br  />
 You insert your MIDI processing function (e.g. myMIDIMessageHandler( )) right inside of the processMIDIMessage( ) call here; the <a class="el" href="class_plugin_base.html" title="The PluginBase object is the base class for the Plugin Core object.">PluginBase</a> will <b>interleave the MIDI message function calls with the processAudioFrames function calls</b> and your MIDI messaging is automatically sample accurate!</p>
<div class="fragment"><div class="line"><span class="comment">// --- IF PROCESSING AUDIO FRAMES: decode AND service this MIDI event here</span></div>
<div class="line"><span class="comment">//     for sample accurate MIDI</span></div>
<div class="line"><span class="comment">// myMIDIMessageHandler(event); // &lt;-- you write this</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="simple_plugin.html">Write a Plugin</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
