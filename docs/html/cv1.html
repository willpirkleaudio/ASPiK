<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Creation &amp; Communication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cv1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Creation &amp; Communication </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Custom View Creation</b><br  />
 VSTGUI has a built-in mechanism for identifying GUI objects in the XML description files as requiring custom view creation. An attribute named <b>custom-view-name</b> stores a string that identifies the object. During creation, the VSTGUI object class factory normally reads the XML file and generates the appropriate GUI object as specified. The PluginGUI object is given the first chance of creating the GUI objects during a function call to a view creation method. That method decodes the custom view name, constructs the custom object (which must ultimately derive from VSTGUI::CView), and returns a pointer to the object. It is during this function call that we have a chance to create a communication mechanism to a custom view object. The PluginGUI object uses an interface passed to it upon creation to register each custom view that it encounters out of the XML file when the user opens the GUI. <br  />
 <br  />
 During the registration process, a pointer to an <b><a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a></b> interface is sent to the plugin shell. The plugin shell object (which creates and destroys the PluginGUI object) will maintain a list of <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interface pointers that are registered with it and will supply the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> with a persistent set of <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interface pointers during the following custom view registration message that is sent to the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a>. In this way, <b>once the plugin core has a registered <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> pointer, it will be guaranteed to be valid and persist for the lifetime of the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a>, regardless of the user’s opening and closing the GUI</b>. So, the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> never holds an actual pointer to a PluginGUI object or interface, and never has to worry about an <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> pointer ever becoming invalid or going out of scope.<br  />
 <br  />
 This <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interface will allow your <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> to send data to the custom view in a safe manner.<br  />
 <br  />
 <b>Custom View Communication</b><br  />
 The fundamental difficulty in communication between the plugin and custom view is in implementing a thread-safe communication system that connects them. There are multiple solutions to the issue and ASPiK uses lock-free ring buffers to send audio data and messages to the custom view objects. The figure below shows the detail from <b>Designing Audio Effects Plugins in C++ 2nd Ed.</b> that shows the ring buffer system. The black dots represent audio samples.<br  />
 <br  />
 </p><div class="image">
<img src="customview1.png" alt=""/>
</div>
<p> <br  />
 The <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> receives audio samples via the processAudioFrame( ) function. For both the waveform histogram and the spectrum view, we will pump all of the incoming audio samples into a ring buffer which will store copies of the data. This happens during the audio thread’s time slice. <br  />
 <br  />
 The GUI is running on a timer that updates it visually every 50 mSec - this is the standard VSTGUI mechanism. The <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> delivers data into the custom view using its <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interface pointer during a GUI update ping, called from the GUI thread. It removes all of the samples that had been used into the ring buffer and sends them into the custom view, which then pushes them into its own lock-free ring buffer. During the drawing update cycle, the custom view then dequeues the data in the ring buffer and draws with it.<br  />
 <br  />
 It should be noted that the use of the second ring buffer on the custom view object is redundant for ASPiK, where the GUI timer ping message and window invalidation (repainting) are synchronized together. However, that might not be the case for some other (non-ASPiK) plugin framework so we add the secondary ring buffer as a backup safety measure. <br  />
 <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer11.html">Custom Views</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
