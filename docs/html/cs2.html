<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Design the Sub-Controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cs2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Design the Sub-Controller </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The sub-controller is implemented as a C++ object that is derived from IController, the VSTGUI4 interface that "listens" to the controls in our group (two knobs and one button in total). In addition, at creation time, any controls that share the same sub-controller object will be registered with the sub-controller during a function called <b>verifyView</b> that will be called once for each control in the group. It is in this function that we will pick up and store pointers to all of the CAnimKnobs in the group. We will also be looking for, and will store the pointer to the CTextButton that will be the linking control. Before going on, you need to understand how sub-controllers get connected to GUI controls.<br  />
 <br  />
 <b>Single Controls</b><br  />
 If you want to add a sub-controller to a single control (and there are valid reasons for doing this), then you just set the "sub-controller" attribute string in the GUI Designer (it is usually just below the "custom-view-name" entry field). At creation time, the sub-controller will be registered (by the VSTGUI core) and then <b>verifyView</b> will get called for the object. The sub-controller can then save a pointer to the object for use during operation.<br  />
 <br  />
 <b>Multiple Controls</b><br  />
 If you want a sub-controller to operate on a set of controls that are all connected to it, then the trick in VSTGUI4 is to create a CViewContainer object to hold all of the controls and <b>set the CViewContainer's sub-controller string in the GUI designer. The CViewContainer will be created first and will then trigger the creation of the sub-controller</b>. After that, each GUI control inside of this container that will be visible will be registered with the sub-controller object via the <b>verifyView</b> method. In this way, all of the objects can share a common sub-controller that will cache pointers to the items in the group and operate on them. This idea can be extended to nested sets of CViewContainer objects as well!<br  />
 <br  />
 <b>Sub-Controller Members</b><br  />
 • We will need a way to store pointers to all of the CAnimKnobs in the group; we can use a std::vector for that <br  />
 • We know that there will be one and only one CTextButton for the link control, so we can just declare a single pointer for it <br  />
 • We are going to also cache a pointer to the parent object that creates the sub-controller, which is the PluginGUI - it is also a IController subclassed object! We'll handle the stuff we need to make our knobs link together, and then we'll forward our unused calls back to the parent IController for further processing. You can approach this design from several vantage points, and this strategy will allow us to only minimally affect the GUI operation, with all other chores handled on the parent object. <br  />
 <br  />
 The sub-controller is defined in the customviews.h file near the bottom so be sure to follow along in that code:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>KnobLinkController : <span class="keyword">public</span> IController</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// snipped code</span></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">   <span class="comment">// --- the parent controller; we can issue IController commands to it!</span></div>
<div class="line">   IController* parentController = <span class="keyword">nullptr</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- a CTextButton is the switcher (linkControl)</span></div>
<div class="line">   CTextButton* linkControl = <span class="keyword">nullptr</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- when linked, all of these controls move when one of them moves,</span></div>
<div class="line">   <span class="comment">//     regardless of their control tags</span></div>
<div class="line">   <span class="keyword">typedef</span> std::vector&lt;CAnimKnob*&gt; KnobList;</div>
<div class="line">   KnobList linkedKnobs;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- flag for linking knobs</span></div>
<div class="line">   <span class="keywordtype">bool</span> linkControls = <span class="keyword">false</span>;</div>
<div class="line">};</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>Constructor In the sub-controller constructor, we will cache the parent pointer and reset the boolean linking flag:</p>
<div class="fragment"><div class="line">KnobLinkController(IController* _parentController)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- save the parent listener</span></div>
<div class="line">   parentController = _parentController;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// --- INITIALIZE LINK STATE</span></div>
<div class="line">   linkControls = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p><b>IController Overrides</b><br  />
 There are multiple ways to handle the sub-controller functionality and in our case we will have a fairly simple setup. You should first read the documentation for the IController in the VSTGUI4 SDK (it uses Doxygen as well for documenting the library). You can find the IController interface in the ..\vstgui4\vstgui\uidescription\icontroller.h file. <br  />
 <br  />
 Here are a list of the functions we'll override and implement with a brief note on their operation:<br  />
 <br  />
 <b>virtual CView* verifyView(CView* view, const UIAttributes&amp; attributes, const IUIDescription* description)</b><br  />
 • we will check the incoming CView* to test if it is a CAnimKnob or a CTextButton <br  />
 • if it is a knob we will add it to our std::vector list <br  />
 • if it is the button, we will set it as the linking device <br  />
 • we will check the button to see if it is already pressed at creation time (it could be a saved state or preset) and we will set our boolean flag if so <br  />
 <br  />
 The fundamental code is here:</p>
<div class="fragment"><div class="line">CAnimKnob* knob = <span class="keyword">dynamic_cast&lt;</span>CAnimKnob*<span class="keyword">&gt;</span>(view);</div>
<div class="line">CTextButton* button = <span class="keyword">dynamic_cast&lt;</span>CTextButton*<span class="keyword">&gt;</span>(view);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// --- save button, push back knob onto list</span></div>
<div class="line"><span class="keywordflow">if</span> (button)</div>
<div class="line">{</div>
<div class="line">   linkControl = button;</div>
<div class="line">   <span class="keywordflow">if</span> (button-&gt;getValueNormalized() != 0)</div>
<div class="line">      linkControls = <span class="keyword">true</span>;</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">      linkControls = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (knob)</div>
<div class="line">   linkedKnobs.push_back(knob);</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p><b>virtual void valueChanged(CControl* control) </b><br  />
 • we will check the incoming CControl* - if it is the link button, we'll set our flag <br  />
 • if it is one of the knobs, we will check its value and if the linking flag is set, we will set all the other knobs in the list to match <br  />
 • after any changes are applied, we will forward the call to the parent's valueChanged( ) function for further processing.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> valueChanged(CControl* control) </div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- snipped code</span></div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (control == linkControl)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span> (control-&gt;getValueNormalized() != 0)</div>
<div class="line">         linkControls = <span class="keyword">true</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         linkControls = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> parentController-&gt;valueChanged(control);</div>
<div class="line">   }</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>To set all the knobs together, we just iterate the list of controls:</p>
<div class="fragment"><div class="line"><span class="comment">// --- iterate list</span></div>
<div class="line"><span class="keywordflow">for</span> (std::vector&lt;CAnimKnob*&gt;::iterator itr = linkedKnobs.begin(); itr != linkedKnobs.end(); ++itr)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// --- set the control value for all knobs except the one generating this message</span></div>
<div class="line">   CControl* ctrl = *&lt;/i&gt;i&lt;/i&gt;tr;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (ctrl &amp;&amp; control != ctrl)</div>
<div class="line">   {</div>
<div class="line">      <span class="comment">// --- set the control visually</span></div>
<div class="line">      ctrl-&gt;setValueNormalized(control-&gt;getValueNormalized());</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// --- do the value change at parent level, to set on plugin</span></div>
<div class="line">      parentController-&gt;valueChanged(ctrl);</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>For the rest of these functions, we will forward the function call to the parent (see the code - it is straightforward) </p><div class="fragment"><div class="line"><span class="comment">// --- -just forward these to parent object</span></div>
<div class="line"><span class="keyword">virtual</span> CView* createView(<span class="keyword">const</span> UIAttributes&amp; attributes, <span class="keyword">const</span> IUIDescription* description)</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> controlBeginEdit(CControl* pControl)</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> controlEndEdit(CControl* pControl)</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> controlTagWillChange(CControl* pControl)</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> controlTagDidChange(CControl* pControl)</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --><p>Notice how the sub-controller intelligently handles the connections between the GUI objects and that it is coded in the GUI portion of the ASPiK project - the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects....">PluginCore</a> does not know of the sub-controller's existence (in this case, but that is possible - see below). This is the proper way to handle this kind of arrangement of control functions and you should use the sub-controller paradigm for this kind of GUI customization.<br  />
 <br  />
 With the sub-controller link in place, we need to modify the <b>PluginGUI::createSubController( )</b> function to decode the incoming sub-controller name string and create the device:</p>
<div class="fragment"><div class="line">IController* PluginGUI::createSubController(UTF8StringPtr name, <span class="keyword">const</span> IUIDescription* description)</div>
<div class="line">{</div>
<div class="line">   std::string strName(name);</div>
<div class="line">   <span class="keywordtype">int</span> findIt = strName.find(<span class="stringliteral">&quot;KnobLinkController&quot;</span>);</div>
<div class="line">   <span class="keywordflow">if</span> (findIt &gt;= 0)</div>
<div class="line">   {</div>
<div class="line">      <span class="comment">// --- create the sub-controller</span></div>
<div class="line">      KnobLinkController* knobLinker = <span class="keyword">new</span> KnobLinkController(<span class="keyword">this</span>);</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">return</span> KnobLinkController;</div>
<div class="line">   }</div>
<div class="line"><span class="comment">//</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer12.html">Custom Sub-Controllers</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
